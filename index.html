<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Carrera por la Patente</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;700&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2e;
    --a: #00e5ff;
    --b: #ff3d71;
    --gold: #ffd700;
    --text: #e8e8f0;
    --muted: #555570;
    --accent: #7c3aed;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body { height: 100%; overflow: hidden; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', sans-serif;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 50% 60% at 25% 50%, rgba(0,229,255,0.07) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 75% 50%, rgba(255,61,113,0.07) 0%, transparent 60%);
    pointer-events: none; z-index: 0;
  }

  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(255,255,255,0.018) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.018) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none; z-index: 0;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SETUP SCREEN (names)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #screen-setup {
    position: fixed; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 20; padding: 2rem;
    overflow-y: auto;
  }

  #screen-setup.hidden { display: none; }

  .setup-inner {
    max-width: 560px; width: 100%;
    text-align: center;
  }

  .patent-icon {
    font-size: 3.5rem; display: block;
    margin-bottom: 1rem;
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }

  .intro-title {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(2.8rem, 8vw, 5rem);
    letter-spacing: 0.05em;
    background: linear-gradient(90deg, var(--a), var(--gold), var(--b));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; line-height: 1; margin-bottom: 0.4rem;
  }

  .intro-sub {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.75rem; letter-spacing: 0.18em;
    text-transform: uppercase; color: var(--muted);
    margin-bottom: 2rem;
  }

  /* Steps nav */
  .steps {
    display: flex; align-items: center;
    justify-content: center; gap: 0.5rem;
    margin-bottom: 2rem;
  }

  .step-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--border); transition: background 0.3s, transform 0.3s;
  }

  .step-dot.active { background: var(--gold); transform: scale(1.4); }
  .step-dot.done   { background: var(--a); }

  /* Cards for each setup step */
  .setup-card {
    border: 1px solid var(--border);
    border-radius: 8px; padding: 2rem;
    background: var(--surface);
    display: none;
    animation: fadeUp 0.35s ease;
  }

  .setup-card.active { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .setup-card h2 {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.8rem; letter-spacing: 0.05em;
    margin-bottom: 0.3rem;
  }

  .setup-card h2.color-a { color: var(--a); }
  .setup-card h2.color-b { color: var(--b); }

  .setup-card p {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem; color: var(--muted);
    margin-bottom: 1.5rem; letter-spacing: 0.05em;
  }

  /* Name input */
  .name-input-wrap {
    position: relative; margin-bottom: 1.5rem;
  }

  .name-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.85rem 1rem;
    font-family: 'Bebas Neue', cursive;
    font-size: 1.8rem;
    letter-spacing: 0.05em;
    color: var(--text);
    text-align: center;
    transition: border-color 0.25s;
    outline: none;
  }

  .name-input.input-a:focus { border-color: var(--a); box-shadow: 0 0 0 1px var(--a); }
  .name-input.input-b:focus { border-color: var(--b); box-shadow: 0 0 0 1px var(--b); }

  .name-input::placeholder { color: var(--muted); }

  /* Rules box */
  .rules-box {
    border: 1px solid var(--border); border-radius: 6px;
    padding: 1.5rem; background: var(--surface);
    text-align: left; margin-bottom: 1.5rem;
  }

  .rules-box h3 {
    font-family: 'Bebas Neue', cursive; font-size: 1.2rem;
    color: var(--gold); letter-spacing: 0.05em; margin-bottom: 1rem;
  }

  .rule-item {
    display: flex; gap: 0.75rem; margin-bottom: 0.65rem;
    font-size: 0.82rem; color: var(--muted); line-height: 1.5;
  }

  .rule-num {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.68rem;
    color: var(--accent); flex-shrink: 0; margin-top: 0.15rem;
  }

  .highlight { color: var(--text); }
  .highlight-red { color: var(--b); font-weight: 600; }

  /* Buttons */
  .btn {
    font-family: 'Bebas Neue', cursive; letter-spacing: 0.1em;
    border: none; border-radius: 4px; cursor: pointer;
    transition: all 0.2s ease; position: relative; overflow: hidden;
  }

  .btn::after {
    content: ''; position: absolute; inset: 0;
    background: white; opacity: 0; transition: opacity 0.15s;
  }

  .btn:hover::after { opacity: 0.08; }
  .btn:active::after { opacity: 0.18; }
  .btn:disabled { opacity: 0.25; cursor: not-allowed; }

  .btn-next-a {
    background: var(--a); color: #000;
    font-size: 1.2rem; padding: 0.8rem 2.5rem; width: 100%;
  }

  .btn-next-b {
    background: var(--b); color: #fff;
    font-size: 1.2rem; padding: 0.8rem 2.5rem; width: 100%;
  }

  .btn-start-final {
    background: linear-gradient(135deg, var(--a), var(--accent));
    color: white; font-size: 1.4rem;
    padding: 0.9rem 2.5rem; width: 100%;
  }

  .btn-back {
    background: transparent; color: var(--muted);
    border: 1px solid var(--border); font-size: 1rem;
    padding: 0.6rem 1.5rem; margin-bottom: 0.75rem;
    display: block; width: 100%;
  }

  .btn-back:hover { color: var(--text); border-color: var(--muted); }

  /* preview of both team names */
  .names-preview {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 1rem; margin-bottom: 1.5rem;
  }

  .name-preview-card {
    border-radius: 4px; padding: 0.75rem 1rem;
    border: 1px solid var(--border);
  }

  .name-preview-card.np-a { border-color: var(--a); background: rgba(0,229,255,0.05); }
  .name-preview-card.np-b { border-color: var(--b); background: rgba(255,61,113,0.05); }

  .np-label {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.6rem;
    letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted);
    margin-bottom: 0.25rem;
  }

  .np-name {
    font-family: 'Bebas Neue', cursive; font-size: 1.3rem;
    letter-spacing: 0.05em;
  }

  .np-a .np-name { color: var(--a); }
  .np-b .np-name { color: var(--b); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GAME SCREEN ‚Äî SPLIT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #screen-game {
    position: fixed; inset: 0;
    display: none; z-index: 10;
  }

  #screen-game.active {
    display: grid;
    grid-template-columns: 1fr 1px 1fr;
  }

  .divider {
    background: #1e1e2e; position: relative;
  }

  .divider::after {
    content: ''; position: absolute;
    top: 0; bottom: 0; left: 0; width: 1px;
    background: linear-gradient(180deg, transparent, var(--a) 25%, var(--b) 75%, transparent);
    opacity: 0.45;
  }

  /* ‚îÄ‚îÄ LEFT: Public ‚îÄ‚îÄ */
  .panel-left {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 2rem 2.5rem; gap: 1.4rem; overflow: hidden;
  }

  .left-header { text-align: center; }

  .left-title {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(1.8rem, 3.5vw, 3rem);
    letter-spacing: 0.04em;
    background: linear-gradient(90deg, var(--a), var(--gold), var(--b));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; line-height: 1;
  }

  .left-sub {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.6rem;
    letter-spacing: 0.18em; text-transform: uppercase;
    color: var(--muted); margin-top: 0.25rem;
  }

  /* Prize */
  .prize-block {
    text-align: center; border: 1px solid var(--gold);
    border-radius: 6px; padding: 1rem 2rem;
    background: rgba(255,215,0,0.04); width: 100%; position: relative;
  }

  .prize-block::before {
    content: '‚òÖ PATENTE EN JUEGO ‚òÖ';
    position: absolute; top: 0.35rem; left: 50%; transform: translateX(-50%);
    font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem;
    letter-spacing: 0.18em; color: var(--gold); opacity: 0.6; white-space: nowrap;
  }

  .prize-value {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(3rem, 5.5vw, 5rem);
    color: var(--gold); line-height: 1;
    text-shadow: 0 0 40px rgba(255,215,0,0.35);
  }

  .prize-sub-text {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem;
    color: var(--muted); margin-top: 0.2rem;
  }

  .loss-meter { margin-top: 0.7rem; display: none; }
  .loss-meter.visible { display: block; }
  .loss-label { font-family: 'IBM Plex Mono', monospace; font-size: 0.56rem; letter-spacing: 0.12em; color: var(--muted); margin-bottom: 0.25rem; text-align: center; }
  .loss-bar-track { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .loss-bar-fill { height: 100%; background: linear-gradient(90deg, var(--gold), var(--b)); width: 0%; transition: width 0.5s ease; border-radius: 2px; }

  /* Timer */
  .timer-block {
    display: flex; align-items: center; gap: 1.2rem;
    width: 100%; background: var(--surface);
    border: 1px solid var(--border); border-radius: 6px;
    padding: 1rem 1.2rem; position: relative; overflow: hidden;
    transition: border-color 0.3s;
  }

  .timer-block::before {
    content: ''; position: absolute; inset: 0;
    pointer-events: none; transition: background 0.4s;
  }

  .timer-block.warn-bg::before   { background: rgba(255,215,0,0.04); }
  .timer-block.urgent-bg::before { background: rgba(255,61,113,0.08); }
  .timer-block.warn-bg   { border-color: rgba(255,215,0,0.4); }
  .timer-block.urgent-bg { border-color: rgba(255,61,113,0.45); }

  .timer-ring-container {
    position: relative; width: 90px; height: 90px; flex-shrink: 0;
  }

  .timer-svg { transform: rotate(-90deg); width: 90px; height: 90px; }
  .timer-track { fill: none; stroke: var(--border); stroke-width: 7; }
  .timer-arc {
    fill: none; stroke: var(--a); stroke-width: 7;
    stroke-linecap: round; stroke-dasharray: 283;
    stroke-dashoffset: 0; transition: stroke 0.4s ease;
  }

  .timer-arc.warn   { stroke: var(--gold); }
  .timer-arc.urgent { stroke: var(--b); }

  .timer-number {
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Bebas Neue', cursive; font-size: 2.2rem;
    color: var(--text); transition: color 0.3s;
  }

  .timer-number.warn   { color: var(--gold); }
  .timer-number.urgent { color: var(--b); }

  @keyframes pulse-ring {
    0%,100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .timer-ring-container.pulsing .timer-arc {
    animation: pulse-ring 0.5s ease-in-out infinite;
  }

  .timer-info { flex: 1; z-index: 1; }

  .timer-label {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.52rem;
    letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 0.25rem;
  }

  .timer-turn-text {
    font-family: 'Bebas Neue', cursive; font-size: 1.5rem;
    line-height: 1.1; transition: color 0.3s;
  }

  .timer-sub {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.6rem;
    color: var(--muted); margin-top: 0.2rem;
  }

  /* Bid */
  .bid-block { text-align: center; width: 100%; }

  .bid-label {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem;
    letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 0.25rem;
  }

  .bid-amount {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(4rem, 8vw, 7.5rem);
    line-height: 1; text-shadow: 0 0 60px currentColor; transition: color 0.3s;
  }

  .bid-amount.bump { animation: bump 0.4s cubic-bezier(0.34,1.56,0.64,1); }

  @keyframes bump {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
  }

  .bid-amount.neutral { color: var(--text); }
  .bid-amount.a-color { color: var(--a); }
  .bid-amount.b-color { color: var(--b); }

  .current-bidder-tag {
    display: inline-block; font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem; letter-spacing: 0.14em;
    padding: 0.22rem 0.7rem; border-radius: 2px;
    margin-top: 0.35rem; opacity: 0; transition: opacity 0.3s;
  }

  .current-bidder-tag.visible { opacity: 1; }
  .current-bidder-tag.tag-a { background: rgba(0,229,255,0.15); border: 1px solid var(--a); color: var(--a); }
  .current-bidder-tag.tag-b { background: rgba(255,61,113,0.15); border: 1px solid var(--b); color: var(--b); }

  .warning-strip {
    width: 100%; background: rgba(255,61,113,0.1);
    border: 1px solid rgba(255,61,113,0.35); border-radius: 4px;
    padding: 0.55rem 1rem; font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem; color: var(--b); text-align: center; display: none;
  }

  .warning-strip.show { display: block; }

  /* ‚îÄ‚îÄ RIGHT: Controls ‚îÄ‚îÄ */
  .panel-right {
    display: flex; flex-direction: column;
    padding: 1.5rem 2rem; gap: 1rem;
    overflow-y: auto;
    scrollbar-width: thin; scrollbar-color: var(--border) transparent;
  }

  .right-header {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem;
    letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--muted); border-bottom: 1px solid var(--border);
    padding-bottom: 0.65rem;
  }

  /* Companies */
  .companies { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }

  .company-card {
    border: 1px solid var(--border); border-radius: 4px;
    padding: 1rem; position: relative;
    background: var(--surface); transition: all 0.3s ease;
  }

  .company-card.active-bidder.company-a {
    border-color: var(--a);
    box-shadow: 0 0 0 1px var(--a), 0 0 18px rgba(0,229,255,0.12);
  }

  .company-card.active-bidder.company-b {
    border-color: var(--b);
    box-shadow: 0 0 0 1px var(--b), 0 0 18px rgba(255,61,113,0.12);
  }

  .company-name {
    font-family: 'Bebas Neue', cursive; font-size: 1.4rem;
    letter-spacing: 0.04em; margin-bottom: 0.6rem;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  .company-a .company-name { color: var(--a); }
  .company-b .company-name { color: var(--b); }

  .company-stat { margin-bottom: 0.4rem; }

  .stat-label {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.56rem;
    letter-spacing: 0.16em; color: var(--muted); text-transform: uppercase;
    margin-bottom: 0.12rem;
  }

  .stat-value { font-family: 'IBM Plex Mono', monospace; font-size: 1.1rem; font-weight: 700; }
  .company-a .stat-value { color: var(--a); }
  .company-b .stat-value { color: var(--b); }
  .bet-value { color: var(--text) !important; }

  .active-badge {
    position: absolute; top: 0.65rem; right: 0.65rem;
    font-family: 'IBM Plex Mono', monospace; font-size: 0.52rem;
    letter-spacing: 0.1em; padding: 0.12rem 0.35rem;
    border-radius: 2px; opacity: 0; transition: opacity 0.3s;
  }

  .company-a .active-badge { background: rgba(0,229,255,0.2); color: var(--a); border: 1px solid var(--a); }
  .company-b .active-badge { background: rgba(255,61,113,0.2); color: var(--b); border: 1px solid var(--b); }
  .company-card.active-bidder .active-badge { opacity: 1; }

  /* ‚îÄ‚îÄ BID CONTROLS ‚îÄ‚îÄ */
  .action-area { display: flex; flex-direction: column; gap: 0.65rem; }

  .turn-indicator {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.68rem;
    letter-spacing: 0.12em; color: var(--muted); text-align: center;
  }

  /* Amount selector */
  .amount-selector {
    display: flex; flex-direction: column; gap: 0.4rem;
  }

  .amount-label {
    font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem;
    letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted);
    text-align: center;
  }

  .amount-pills {
    display: flex; gap: 0.4rem; justify-content: center;
  }

  .pill {
    font-family: 'Bebas Neue', cursive; font-size: 1rem;
    letter-spacing: 0.08em; padding: 0.4rem 0.75rem;
    border-radius: 3px; cursor: pointer; transition: all 0.2s;
    border: 1px solid var(--border); background: var(--bg); color: var(--muted);
    flex: 1;
  }

  .pill:hover { border-color: var(--text); color: var(--text); }

  .pill.selected-a { background: rgba(0,229,255,0.15); border-color: var(--a); color: var(--a); }
  .pill.selected-b { background: rgba(255,61,113,0.15); border-color: var(--b); color: var(--b); }

  .pill.selected { border-color: var(--gold); color: var(--gold); background: rgba(255,215,0,0.08); }

  /* Custom amount input */
  .custom-amount-wrap {
    display: flex; gap: 0.4rem; align-items: center;
  }

  .custom-input {
    flex: 1; background: var(--bg); border: 1px solid var(--border);
    border-radius: 3px; padding: 0.4rem 0.6rem;
    font-family: 'IBM Plex Mono', monospace; font-size: 1rem;
    color: var(--text); text-align: center; outline: none;
    transition: border-color 0.2s;
  }

  .custom-input:focus { border-color: var(--gold); }
  .custom-input::placeholder { color: var(--muted); font-size: 0.75rem; }

  .btn-apply {
    font-family: 'Bebas Neue', cursive; font-size: 0.95rem;
    padding: 0.4rem 0.9rem; background: rgba(255,215,0,0.15);
    border: 1px solid var(--gold); color: var(--gold);
    border-radius: 3px; cursor: pointer; transition: all 0.2s;
    white-space: nowrap;
  }

  .btn-apply:hover { background: rgba(255,215,0,0.25); }

  /* Bid buttons */
  .btn-group { display: flex; gap: 0.6rem; }

  .btn-bid {
    font-family: 'Bebas Neue', cursive; font-size: 1rem;
    letter-spacing: 0.08em; padding: 0.7rem 1rem;
    border: none; border-radius: 4px; cursor: pointer;
    transition: all 0.2s; position: relative; overflow: hidden; flex: 1;
  }

  .btn-bid::after {
    content: ''; position: absolute; inset: 0;
    background: white; opacity: 0; transition: opacity 0.15s;
  }

  .btn-bid:hover::after { opacity: 0.08; }
  .btn-bid:active::after { opacity: 0.18; }
  .btn-bid:disabled { opacity: 0.25; cursor: not-allowed; }

  .btn-bid-a { background: var(--a); color: #000; }
  .btn-bid-b { background: var(--b); color: #fff; }

  /* Surrender */
  .btn-surrender {
    font-family: 'Bebas Neue', cursive; font-size: 0.95rem;
    letter-spacing: 0.08em; padding: 0.55rem 1rem;
    background: transparent; color: var(--b);
    border: 1px solid rgba(255,61,113,0.4); border-radius: 4px;
    cursor: pointer; transition: all 0.2s; width: 100%;
  }

  .btn-surrender:hover { border-color: var(--b); background: rgba(255,61,113,0.06); }

  .surrender-menu { display: none; flex-direction: column; gap: 0.5rem; }
  .surrender-menu.open { display: flex; }

  .btn-surr-choice {
    font-family: 'Bebas Neue', cursive; font-size: 1rem;
    letter-spacing: 0.08em; padding: 0.65rem 1rem;
    border: none; border-radius: 4px; cursor: pointer;
    transition: all 0.2s; flex: 1; position: relative; overflow: hidden;
  }

  .btn-surr-choice::after { content: ''; position: absolute; inset: 0; background: white; opacity: 0; transition: 0.15s; }
  .btn-surr-choice:hover::after { opacity: 0.08; }
  .btn-surr-a { background: var(--a); color: #000; }
  .btn-surr-b { background: var(--b); color: #fff; }

  .btn-cancel {
    font-family: 'Bebas Neue', cursive; font-size: 0.95rem;
    padding: 0.55rem; background: transparent; color: var(--muted);
    border: 1px solid var(--border); border-radius: 4px; cursor: pointer;
    transition: all 0.2s;
  }

  .btn-cancel:hover { color: var(--text); border-color: var(--muted); }

  /* LOG */
  .log-section {
    flex: 1; min-height: 0; border: 1px solid var(--border);
    border-radius: 4px; background: rgba(0,0,0,0.3);
    overflow: hidden; display: flex; flex-direction: column;
  }

  .log-header {
    padding: 0.55rem 0.9rem; border-bottom: 1px solid var(--border);
    font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem;
    letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase;
    flex-shrink: 0;
  }

  .log-body {
    flex: 1; overflow-y: auto; padding: 0.35rem 0;
    scrollbar-width: thin; scrollbar-color: var(--border) transparent;
  }

  .log-entry {
    padding: 0.38rem 0.9rem; font-family: 'IBM Plex Mono', monospace;
    font-size: 0.68rem; display: flex; gap: 0.65rem;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    animation: slideIn 0.25s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-6px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  .log-time { color: var(--muted); flex-shrink: 0; }
  .log-text { flex: 1; }
  .log-a { color: var(--a); }
  .log-b { color: var(--b); }
  .log-system { color: var(--muted); font-style: italic; }
  .log-gold { color: var(--gold); }
  .log-warn { color: var(--b); font-weight: bold; }

  /* ‚îÄ‚îÄ RESULT OVERLAY ‚îÄ‚îÄ */
  .result-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.92);
    display: flex; align-items: center; justify-content: center;
    z-index: 200; opacity: 0; pointer-events: none;
    transition: opacity 0.5s; backdrop-filter: blur(12px);
  }

  .result-overlay.show { opacity: 1; pointer-events: all; }

  .result-card {
    text-align: center; max-width: 560px; width: 90%;
    padding: 2.5rem 2rem; background: var(--surface);
    border: 1px solid var(--border); border-radius: 8px;
    transform: scale(0.85);
    transition: transform 0.5s cubic-bezier(0.34,1.56,0.64,1);
    position: relative; overflow: hidden;
  }

  .result-overlay.show .result-card { transform: scale(1); }

  .result-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  }

  .result-card.winner-a::before { background: var(--a); }
  .result-card.winner-b::before { background: var(--b); }

  .confetti-emoji {
    font-size: 3.5rem; display: block; margin-bottom: 0.8rem;
    animation: spinIn 0.7s cubic-bezier(0.34,1.56,0.64,1);
  }

  @keyframes spinIn {
    from { transform: rotate(-20deg) scale(0); }
    to   { transform: rotate(0) scale(1); }
  }

  .result-title { font-family: 'Bebas Neue', cursive; font-size: 2.2rem; letter-spacing: 0.05em; line-height: 1; margin-bottom: 0.3rem; }
  .result-winner-name { font-family: 'Bebas Neue', cursive; font-size: 2rem; margin-bottom: 1.3rem; }
  .result-a { color: var(--a); }
  .result-b { color: var(--b); }

  .result-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.2rem; }

  .result-stat { padding: 0.85rem; border-radius: 4px; border: 1px solid var(--border); }
  .result-stat.winner-stat { border-color: var(--gold); background: rgba(255,215,0,0.05); }
  .result-stat.loser-stat  { border-color: rgba(255,61,113,0.3); background: rgba(255,61,113,0.05); }
  .result-stat-label { font-family: 'IBM Plex Mono', monospace; font-size: 0.58rem; letter-spacing: 0.1em; color: var(--muted); text-transform: uppercase; margin-bottom: 0.25rem; }
  .result-stat-val { font-family: 'Bebas Neue', cursive; font-size: 1.8rem; }

  .result-lesson {
    font-size: 0.78rem; color: var(--muted); line-height: 1.65;
    margin-bottom: 1.5rem; padding: 0.85rem;
    background: rgba(255,255,255,0.02); border-radius: 4px;
    border-left: 2px solid var(--accent); text-align: left;
  }

  .btn-new-game {
    font-family: 'Bebas Neue', cursive; font-size: 1.3rem;
    letter-spacing: 0.1em; padding: 0.8rem 2.5rem;
    background: linear-gradient(135deg, var(--a), var(--accent));
    color: white; border: none; border-radius: 4px; cursor: pointer;
    transition: all 0.2s; position: relative; overflow: hidden;
  }

  .btn-new-game::after { content: ''; position: absolute; inset: 0; background: white; opacity: 0; transition: 0.15s; }
  .btn-new-game:hover::after { opacity: 0.08; }

  @keyframes timeout-flash {
    0%,100% { background: var(--bg); }
    35%,65% { background: #180610; }
  }
  .timeout-flash { animation: timeout-flash 0.7s ease; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETUP: step 1 ‚Äî Empresa A ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-setup">
  <div class="setup-inner">
    <span class="patent-icon">‚ö°</span>
    <div class="intro-title">La Carrera<br>por la Patente</div>
    <div class="intro-sub">Teor√≠a de Juegos ¬∑ Subasta de Guerra</div>

    <div class="steps">
      <div class="step-dot active" id="dot-0"></div>
      <div class="step-dot" id="dot-1"></div>
      <div class="step-dot" id="dot-2"></div>
    </div>

    <!-- Step 0: Name Empresa A -->
    <div class="setup-card active" id="step-0">
      <h2 class="color-a">Empresa A</h2>
      <p>¬øCu√°l es el nombre de la primera empresa?</p>
      <div class="name-input-wrap">
        <input class="name-input input-a" id="name-a" type="text"
               placeholder="APPLE, SAMSUNG‚Ä¶" maxlength="24"
               oninput="syncNameA()" onkeydown="if(event.key==='Enter') goStep(1)">
      </div>
      <button class="btn btn-next-a" onclick="goStep(1)">SIGUIENTE ‚Üí</button>
    </div>

    <!-- Step 1: Name Empresa B -->
    <div class="setup-card" id="step-1">
      <h2 class="color-b">Empresa B</h2>
      <p>¬øCu√°l es el nombre de la segunda empresa?</p>
      <div class="name-input-wrap">
        <input class="name-input input-b" id="name-b" type="text"
               placeholder="GOOGLE, MICROSOFT‚Ä¶" maxlength="24"
               oninput="syncNameB()" onkeydown="if(event.key==='Enter') goStep(2)">
      </div>
      <button class="btn btn-next-b" onclick="goStep(2)">SIGUIENTE ‚Üí</button>
      <br><br>
      <button class="btn btn-back" onclick="goStep(0)">‚Üê ATR√ÅS</button>
    </div>

    <!-- Step 2: Rules + confirm -->
    <div class="setup-card" id="step-2">
      <div class="names-preview">
        <div class="name-preview-card np-a">
          <div class="np-label">Empresa A</div>
          <div class="np-name" id="preview-a">‚Äî</div>
        </div>
        <div class="name-preview-card np-b">
          <div class="np-label">Empresa B</div>
          <div class="np-name" id="preview-b">‚Äî</div>
        </div>
      </div>

      <div class="rules-box">
        <h3>‚ö† Las Reglas del Juego</h3>
        <div class="rule-item"><span class="rule-num">01</span><span>La subasta empieza en <span class="highlight">$1</span> y pueden subir en varios montos.</span></div>
        <div class="rule-item"><span class="rule-num">02</span><span>El que puje m√°s alto <span class="highlight">gana la patente</span> ($100 de valor).</span></div>
        <div class="rule-item"><span class="rule-num">03</span><span class="highlight-red">TRAMPA: El segundo lugar tambi√©n paga su √∫ltima oferta y no recibe nada.</span></div>
        <div class="rule-item"><span class="rule-num">04</span><span>Cada equipo tiene <span class="highlight">15 segundos</span> para decidir. Si el tiempo se agota, el rival gana.</span></div>
        <div class="rule-item"><span class="rule-num">05</span><span>Cualquier empresa puede <span class="highlight">rendirse</span>, pero igual paga lo ofrecido.</span></div>
      </div>

      <button class="btn btn-start-final" onclick="launchGame()">‚ö° INICIAR SUBASTA</button>
      <br><br>
      <button class="btn btn-back" onclick="goStep(1)">‚Üê ATR√ÅS</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-game">

  <!-- LEFT: Public display -->
  <div class="panel-left">

    <div class="left-header">
      <div class="left-title">La Carrera por la Patente</div>
      <div class="left-sub">Teor√≠a de Juegos ¬∑ Subasta de Guerra</div>
    </div>

    <div class="prize-block">
      <div class="prize-value">$100</div>
      <div class="prize-sub-text">valor de la patente en disputa</div>
      <div class="loss-meter" id="loss-meter">
        <div class="loss-label">P√âRDIDA COMBINADA PROYECTADA</div>
        <div class="loss-bar-track"><div class="loss-bar-fill" id="loss-bar"></div></div>
      </div>
    </div>

    <div class="timer-block" id="timer-block">
      <div class="timer-ring-container" id="timer-ring-container">
        <svg class="timer-svg" viewBox="0 0 100 100">
          <circle class="timer-track" cx="50" cy="50" r="45"/>
          <circle class="timer-arc" id="timer-arc" cx="50" cy="50" r="45"/>
        </svg>
        <div class="timer-number" id="timer-number">30</div>
      </div>
      <div class="timer-info">
        <div class="timer-label">‚è± TIEMPO RESTANTE ‚Äî TURNO DE</div>
        <div class="timer-turn-text" id="timer-turn-text">‚Äî ‚Äî ‚Äî</div>
        <div class="timer-sub" id="timer-sub">El juego est√° por comenzar</div>
      </div>
    </div>

    <div class="bid-block">
      <div class="bid-label">OFERTA ACTUAL</div>
      <div class="bid-amount neutral" id="bid-amount">$0</div>
      <div class="current-bidder-tag" id="bidder-tag">‚Äî</div>
    </div>

    <div class="warning-strip" id="warning-strip">
      ‚ö† La oferta supera el valor de la patente. Ambas empresas en zona de p√©rdida neta.
    </div>

  </div>

  <!-- Divider -->
  <div class="divider"></div>

  <!-- RIGHT: Controls -->
  <div class="panel-right">

    <div class="right-header">üéÆ Panel de Control ‚Äî Profesor</div>

    <div class="companies">
      <div class="company-card company-a" id="card-a">
        <span class="active-badge">TURNO ‚ñ∂</span>
        <div class="company-name" id="cname-a">Empresa A</div>
        <div class="company-stat">
          <div class="stat-label">Oferta actual</div>
          <div class="stat-value bet-value" id="bet-a">$0</div>
        </div>
        <div class="company-stat">
          <div class="stat-label">Estado</div>
          <div class="stat-value" id="status-a">EN ESPERA</div>
        </div>
      </div>
      <div class="company-card company-b" id="card-b">
        <span class="active-badge">TURNO ‚ñ∂</span>
        <div class="company-name" id="cname-b">Empresa B</div>
        <div class="company-stat">
          <div class="stat-label">Oferta actual</div>
          <div class="stat-value bet-value" id="bet-b">$0</div>
        </div>
        <div class="company-stat">
          <div class="stat-label">Estado</div>
          <div class="stat-value" id="status-b">EN ESPERA</div>
        </div>
      </div>
    </div>

    <div class="action-area">
      <div class="turn-indicator" id="turn-indicator">Esperando inicio‚Ä¶</div>

      <!-- Amount selector -->
      <div class="amount-selector">
        <div class="amount-label">‚¨Ü Monto de la puja</div>
        <div class="amount-pills">
          <div class="pill selected" data-val="1" onclick="selectPill(this)">+$1</div>
          <div class="pill" data-val="5"  onclick="selectPill(this)">+$5</div>
          <div class="pill" data-val="10" onclick="selectPill(this)">+$10</div>
          <div class="pill" data-val="25" onclick="selectPill(this)">+$25</div>
        </div>
        <div class="custom-amount-wrap">
          <input class="custom-input" id="custom-amount" type="number" min="1" max="999" placeholder="Monto personalizado‚Ä¶">
          <button class="btn-apply" onclick="applyCustom()">APLICAR</button>
        </div>
      </div>

      <!-- Bid buttons -->
      <div class="btn-group">
        <button class="btn-bid btn-bid-a" id="btn-bid-a" onclick="placeBid('A')">
          ‚¨Ü <span id="btn-label-a">PUJA</span>
        </button>
        <button class="btn-bid btn-bid-b" id="btn-bid-b" onclick="placeBid('B')">
          ‚¨Ü <span id="btn-label-b">PUJA</span>
        </button>
      </div>

      <!-- Surrender -->
      <button class="btn-surrender" onclick="showSurrenderMenu()">üè≥ RENDIRSE</button>

      <div class="surrender-menu" id="surrender-menu">
        <div class="turn-indicator" style="color:var(--b);">¬øQui√©n se rinde? Paga su oferta y pierde.</div>
        <div class="btn-group">
          <button class="btn-surr-choice btn-surr-a" id="btn-surr-a" onclick="surrender('A')">üè≥ <span id="surr-label-a">A</span> SE RINDE</button>
          <button class="btn-surr-choice btn-surr-b" id="btn-surr-b" onclick="surrender('B')">üè≥ <span id="surr-label-b">B</span> SE RINDE</button>
        </div>
        <button class="btn-cancel" onclick="hideSurrenderMenu()">CANCELAR</button>
      </div>
    </div>

    <div class="log-section">
      <div class="log-header">üìã Historial de Pujas</div>
      <div class="log-body" id="log-body"></div>
    </div>

  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MATRIZ MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="matriz-modal" style="
  position:fixed;inset:0;z-index:300;
  display:none;align-items:flex-start;justify-content:center;
  background:rgba(0,0,0,0.93);backdrop-filter:blur(16px);
  padding:0;overflow-y:auto;
">
<div style="
  width:100%;min-height:100%;
  background:#12121a;border:none;border-radius:0;
  overflow:hidden;position:relative;
  animation:mzFadeIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
">

<style>
@keyframes mzFadeIn{from{opacity:0;transform:scale(0.88)}to{opacity:1;transform:scale(1)}}
@keyframes mzBarGrow{from{width:0}to{width:var(--w)}}
@keyframes mzPulse{0%,100%{opacity:1}50%{opacity:0.4}}

#matriz-modal .mz-header{
  padding:2rem 4rem;
  background:linear-gradient(135deg,rgba(0,229,255,0.06),rgba(255,61,113,0.06));
  border-bottom:1px solid #1e1e2e;
  display:flex;align-items:center;justify-content:space-between;gap:1rem;
}
#matriz-modal .mz-title{
  font-family:'Bebas Neue',cursive;font-size:1.8rem;letter-spacing:0.05em;
  background:linear-gradient(90deg,#00e5ff,#ffd700,#ff3d71);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;
}
#matriz-modal .mz-subtitle{
  font-family:'IBM Plex Mono',monospace;font-size:0.62rem;letter-spacing:0.15em;
  text-transform:uppercase;color:#555570;margin-top:0.3rem;
}
#matriz-modal .mz-close{
  font-family:'Bebas Neue',cursive;font-size:1rem;letter-spacing:0.1em;
  padding:0.5rem 1.1rem;background:transparent;color:#555570;
  border:1px solid #1e1e2e;border-radius:4px;cursor:pointer;transition:all 0.2s;flex-shrink:0;
}
#matriz-modal .mz-close:hover{color:#e8e8f0;border-color:#555570;}
#matriz-modal .mz-result-banner{
  display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap;
  padding:1rem 4rem;background:rgba(255,215,0,0.04);border-bottom:1px solid #1e1e2e;
}
#matriz-modal .mz-rb-item{text-align:center;}
#matriz-modal .mz-rb-label{
  font-family:'IBM Plex Mono',monospace;font-size:0.56rem;
  letter-spacing:0.18em;text-transform:uppercase;color:#555570;margin-bottom:0.15rem;
}
#matriz-modal .mz-rb-val{font-family:'Bebas Neue',cursive;font-size:1.6rem;line-height:1;}
#matriz-modal .mz-rb-divider{width:1px;height:36px;background:#1e1e2e;flex-shrink:0;}
#matriz-modal .mz-body{padding:2rem 4rem 3rem;max-width:none;}
#matriz-modal .mz-section-label{
  font-family:'IBM Plex Mono',monospace;font-size:0.6rem;letter-spacing:0.22em;
  text-transform:uppercase;color:#555570;margin-bottom:1rem;
}
#matriz-modal .mz-grid{
  display:grid;grid-template-columns:160px 1fr 1fr;
  gap:2px;background:#1e1e2e;border:1px solid #1e1e2e;
  border-radius:8px;overflow:hidden;margin-bottom:2rem;
}
#matriz-modal .mz-corner{
  background:#0e0e18;display:flex;align-items:center;justify-content:center;
  padding:0.75rem;position:relative;
}
#matriz-modal .mz-corner::after{
  content:'';position:absolute;bottom:0;right:0;
  border-style:solid;border-width:0 0 20px 20px;
  border-color:transparent transparent #1e1e2e transparent;
}
#matriz-modal .mz-corner-text{
  font-family:'IBM Plex Mono',monospace;font-size:0.52rem;
  letter-spacing:0.12em;text-transform:uppercase;color:#555570;text-align:center;line-height:1.4;
}
#matriz-modal .mz-ch{
  background:#0e0e18;display:flex;flex-direction:column;
  align-items:center;justify-content:center;padding:0.75rem;gap:0.15rem;
}
#matriz-modal .mz-ch-tag{
  font-family:'IBM Plex Mono',monospace;font-size:0.52rem;letter-spacing:0.15em;text-transform:uppercase;
}
#matriz-modal .mz-ch-action{font-family:'Bebas Neue',cursive;font-size:1.1rem;letter-spacing:0.05em;}
#matriz-modal .mz-ch-action.puja{color:#ffd700;}
#matriz-modal .mz-ch-action.nopuja{color:#555570;}
#matriz-modal .mz-rh{
  background:#0e0e18;display:flex;flex-direction:column;
  align-items:center;justify-content:center;padding:0.75rem;gap:0.15rem;
}
#matriz-modal .mz-rh-tag{
  font-family:'IBM Plex Mono',monospace;font-size:0.52rem;letter-spacing:0.15em;text-transform:uppercase;
}
#matriz-modal .mz-rh-action{font-family:'Bebas Neue',cursive;font-size:1.1rem;letter-spacing:0.05em;}
#matriz-modal .mz-rh-action.puja{color:#ffd700;}
#matriz-modal .mz-rh-action.nopuja{color:#555570;}
#matriz-modal .mz-cell{
  background:#13131e;padding:1.1rem;position:relative;overflow:hidden;transition:background 0.25s;
}
#matriz-modal .mz-cell.this-game{
  background:#16161f;outline:2px solid #ffd700;outline-offset:-2px;
}
#matriz-modal .mz-cell-tag{
  font-family:'IBM Plex Mono',monospace;font-size:0.54rem;letter-spacing:0.14em;
  text-transform:uppercase;margin-bottom:0.6rem;display:flex;align-items:center;gap:0.35rem;
}
#matriz-modal .mz-cell-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
#matriz-modal .mz-prob-wrap{margin-bottom:0.75rem;}
#matriz-modal .mz-prob-row{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.4rem;}
#matriz-modal .mz-prob-who{
  font-family:'IBM Plex Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;
  text-transform:uppercase;width:56px;flex-shrink:0;
}
#matriz-modal .mz-bar-bg{
  flex:1;height:12px;background:#0a0a0f;border-radius:6px;overflow:hidden;border:1px solid #1e1e2e;
}
#matriz-modal .mz-bar-fill{
  height:100%;border-radius:6px;
  width:var(--w);animation:mzBarGrow 1s cubic-bezier(0.34,1.56,0.64,1) forwards;
}
#matriz-modal .mz-bar-pct{font-family:'Bebas Neue',cursive;font-size:0.9rem;width:34px;text-align:right;flex-shrink:0;}
#matriz-modal .mz-chips{display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.65rem;}
#matriz-modal .mz-chip{
  font-family:'IBM Plex Mono',monospace;font-size:0.6rem;
  letter-spacing:0.1em;padding:0.22rem 0.65rem;border-radius:3px;border:1px solid;
}
#matriz-modal .chip-win{border-color:rgba(0,230,118,0.4);color:#00e676;background:rgba(0,230,118,0.06);}
#matriz-modal .chip-lose{border-color:rgba(255,61,113,0.4);color:#ff3d71;background:rgba(255,61,113,0.06);}
#matriz-modal .chip-zero{border-color:#1e1e2e;color:#555570;background:rgba(255,255,255,0.02);}
#matriz-modal .chip-warn{border-color:rgba(255,215,0,0.4);color:#ffd700;background:rgba(255,215,0,0.06);}
#matriz-modal .mz-cell-desc{
  font-family:'IBM Plex Mono',monospace;font-size:0.6rem;color:#555570;
  line-height:1.55;border-top:1px solid #1e1e2e;padding-top:0.65rem;
}
#matriz-modal .mz-cell-desc strong{color:#a0a0b8;}
#matriz-modal .mz-live-badge{
  position:absolute;top:0.55rem;right:0.55rem;
  font-family:'IBM Plex Mono',monospace;font-size:0.5rem;
  letter-spacing:0.12em;padding:0.12rem 0.4rem;border-radius:2px;
  border:1px solid #ffd700;color:#ffd700;background:rgba(255,215,0,0.1);
  animation:mzPulse 1.5s ease-in-out infinite;
}
#matriz-modal .mz-legend{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;margin-bottom:2rem;}
#matriz-modal .mz-legend-card{border:1px solid #1e1e2e;border-radius:6px;padding:0.9rem 1rem;background:#0e0e18;}
#matriz-modal .mz-leg-icon{font-size:1.2rem;display:block;margin-bottom:0.35rem;}
#matriz-modal .mz-leg-name{font-family:'Bebas Neue',cursive;font-size:1rem;letter-spacing:0.05em;color:#e8e8f0;margin-bottom:0.2rem;}
#matriz-modal .mz-leg-desc{font-family:'IBM Plex Mono',monospace;font-size:0.6rem;color:#555570;line-height:1.55;}
#matriz-modal .mz-footer{
  padding:1.5rem 4rem 2rem;display:flex;gap:0.75rem;justify-content:center;
  flex-wrap:wrap;border-top:1px solid #1e1e2e;
}
#matriz-modal .mz-btn-close{
  font-family:'Bebas Neue',cursive;font-size:1.2rem;letter-spacing:0.1em;
  padding:0.75rem 2rem;background:linear-gradient(135deg,#00e5ff,#7c3aed);
  color:#fff;border:none;border-radius:4px;cursor:pointer;transition:all 0.2s;
}
#matriz-modal .mz-btn-close:hover{filter:brightness(1.1);}
#matriz-modal .mz-btn-new{
  font-family:'Bebas Neue',cursive;font-size:1.2rem;letter-spacing:0.1em;
  padding:0.75rem 2rem;background:transparent;color:#555570;
  border:1px solid #1e1e2e;border-radius:4px;cursor:pointer;transition:all 0.2s;
}
#matriz-modal .mz-btn-new:hover{color:#e8e8f0;border-color:#555570;}
</style>

<div class="mz-header">
  <div>
    <div class="mz-title">Matriz de Probabilidades</div>
    <div class="mz-subtitle">An√°lisis cuantitativo del juego ¬∑ Generado al finalizar</div>
  </div>
  <button class="mz-close" onclick="closeMzModal()">‚úï CERRAR</button>
</div>

<div class="mz-result-banner" id="mz-banner"></div>

<div class="mz-body">
  <div class="mz-section-label">‚ñ∏ Matriz de pagos 2√ó2 ‚Äî <span id="mz-names-label">Empresa 1 vs Empresa 2</span></div>

  <div class="mz-grid">
    <div class="mz-corner"><div class="mz-corner-text" id="mz-corner">E1 ‚Üì / E2 ‚Üí</div></div>
    <div class="mz-ch">
      <div class="mz-ch-tag" style="color:#ff3d71" id="mz-ch-b1"></div>
      <div class="mz-ch-action puja">PUJA</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.5rem;color:#555570;margin-top:0.15rem;">hace oferta</div>
    </div>
    <div class="mz-ch">
      <div class="mz-ch-tag" style="color:#ff3d71" id="mz-ch-b2"></div>
      <div class="mz-ch-action nopuja">NO PUJA</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.5rem;color:#555570;margin-top:0.15rem;">se retira</div>
    </div>

    <div class="mz-rh">
      <div class="mz-rh-tag" style="color:#00e5ff" id="mz-rh-a1"></div>
      <div class="mz-rh-action puja">PUJA</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.5rem;color:#555570;margin-top:0.15rem;">hace oferta</div>
    </div>

    <div class="mz-cell" id="mz-cell-war">
      <div class="mz-live-badge" id="mz-badge-war" style="display:none">‚òÖ ESTE JUEGO</div>
      <div class="mz-cell-tag"><div class="mz-cell-dot" style="background:#ffd700"></div><span style="color:#ffd700">‚öî AMBOS PUJAN</span></div>
      <div class="mz-prob-wrap" id="mz-prob-war"></div>
      <div class="mz-chips" id="mz-chips-war"></div>
      <div class="mz-cell-desc" id="mz-desc-war"></div>
    </div>

    <div class="mz-cell" id="mz-cell-win1">
      <div class="mz-live-badge" id="mz-badge-win1" style="display:none">‚òÖ ESTE JUEGO</div>
      <div class="mz-cell-tag"><div class="mz-cell-dot" style="background:#00e5ff"></div><span style="color:#00e5ff" id="mz-tag-win1">‚úì GANA E1</span></div>
      <div class="mz-prob-wrap" id="mz-prob-win1"></div>
      <div class="mz-chips" id="mz-chips-win1"></div>
      <div class="mz-cell-desc" id="mz-desc-win1"></div>
    </div>

    <div class="mz-rh">
      <div class="mz-rh-tag" style="color:#00e5ff" id="mz-rh-a2"></div>
      <div class="mz-rh-action nopuja">NO PUJA</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.5rem;color:#555570;margin-top:0.15rem;">se retira</div>
    </div>

    <div class="mz-cell" id="mz-cell-win2">
      <div class="mz-live-badge" id="mz-badge-win2" style="display:none">‚òÖ ESTE JUEGO</div>
      <div class="mz-cell-tag"><div class="mz-cell-dot" style="background:#ff3d71"></div><span style="color:#ff3d71" id="mz-tag-win2">‚úì GANA E2</span></div>
      <div class="mz-prob-wrap" id="mz-prob-win2"></div>
      <div class="mz-chips" id="mz-chips-win2"></div>
      <div class="mz-cell-desc" id="mz-desc-win2"></div>
    </div>

    <div class="mz-cell" id="mz-cell-none">
      <div class="mz-live-badge" id="mz-badge-none" style="display:none">‚òÖ ESTE JUEGO</div>
      <div class="mz-cell-tag"><div class="mz-cell-dot" style="background:#555570"></div><span style="color:#555570">‚óå NADIE PUJA</span></div>
      <div class="mz-prob-wrap" id="mz-prob-none"></div>
      <div class="mz-chips" id="mz-chips-none"></div>
      <div class="mz-cell-desc" id="mz-desc-none"></div>
    </div>
  </div>

  <div class="mz-section-label" style="margin-top:0.5rem;">‚ñ∏ Conceptos de Teor√≠a de Juegos</div>
  <div class="mz-legend">
    <div class="mz-legend-card">
      <span class="mz-leg-icon">‚öñÔ∏è</span>
      <div class="mz-leg-name">Equilibrio de Nash</div>
      <div class="mz-leg-desc">Ning√∫n jugador puede mejorar su resultado cambiando su estrategia <strong style="color:#a0a0b8">unilateralmente</strong>. En esta subasta, ambas empresas quedan atrapadas pujando aunque supere el valor real.</div>
    </div>
    <div class="mz-legend-card">
      <span class="mz-leg-icon">üí∏</span>
      <div class="mz-leg-name">Costo Hundido</div>
      <div class="mz-leg-desc">El dinero ya apostado <strong style="color:#a0a0b8">no deber√≠a</strong> influir en decisiones futuras, pero psicol√≥gicamente empuja a seguir pujando para "recuperar lo perdido".</div>
    </div>
    <div class="mz-legend-card">
      <span class="mz-leg-icon">üèÜ</span>
      <div class="mz-leg-name">Maldici√≥n del Ganador</div>
      <div class="mz-leg-desc">El ganador frecuentemente paga <strong style="color:#a0a0b8">m√°s de lo que vale</strong> el activo. La presi√≥n competitiva distorsiona la valoraci√≥n racional.</div>
    </div>
    <div class="mz-legend-card">
      <span class="mz-leg-icon">üìâ</span>
      <div class="mz-leg-name">Destrucci√≥n de Valor</div>
      <div class="mz-leg-desc">Si la suma de pujas supera $100, <strong style="color:#a0a0b8">se destruye valor neto</strong> entre ambas empresas. El mercado genera un resultado peor que la cooperaci√≥n.</div>
    </div>
  </div>
</div>

<div class="mz-footer">
  <button class="mz-btn-close" onclick="closeMzModal()">‚úì ENTENDIDO</button>
  <button class="mz-btn-new" onclick="closeMzModal();resetGame()">‚Ü© NUEVA SUBASTA</button>
</div>
</div>
</div>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIN MATRIZ MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- RESULT OVERLAY -->
<div class="result-overlay" id="result-overlay">
  <div class="result-card" id="result-card">
    <span class="confetti-emoji" id="result-emoji">üèÜ</span>
    <div class="result-title" id="result-title">GANADOR</div>
    <div class="result-winner-name" id="result-winner"></div>
    <div class="result-stats" id="result-stats"></div>
    <div class="result-lesson" id="result-lesson"></div>
    <button class="btn-new-game" onclick="resetGame()">‚Ü© NUEVA SUBASTA</button>
  </div>
</div>

<script>
  const PRIZE_VALUE = 100;
  const TURN_SECONDS = 15;
  const CIRC = 2 * Math.PI * 45; // 282.74

  // Company names (set on setup)
  let names = { A: 'Empresa A', B: 'Empresa B' };

  // Selected bid increment
  let bidAmount = 1;

  let state = {
    currentBid: 0,
    lastBidder: null,
    bets: { A: 0, B: 0 },
    turn: 'A',
    finished: false
  };

  let timerInterval = null;
  let timeLeft = TURN_SECONDS;

  // ‚îÄ‚îÄ‚îÄ BROADCAST to matriz-juego via localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function broadcast(eventType, extra = {}) {
    const payload = {
      type: eventType,
      names: { ...names },
      state: JSON.parse(JSON.stringify(state)),
      timeLeft,
      prizeValue: PRIZE_VALUE,
      ts: Date.now(),
      ...extra
    };
    try { localStorage.setItem('patente_game', JSON.stringify(payload)); } catch(e) {}
  }

  // ‚îÄ‚îÄ‚îÄ SETUP STEPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  let currentStep = 0;

  function goStep(n) {
    // validate before advancing
    if (n === 1) {
      const v = document.getElementById('name-a').value.trim();
      if (!v) { document.getElementById('name-a').focus(); return; }
    }
    if (n === 2) {
      const v = document.getElementById('name-b').value.trim();
      if (!v) { document.getElementById('name-b').focus(); return; }
      // Update preview
      document.getElementById('preview-a').textContent = document.getElementById('name-a').value.trim().toUpperCase();
      document.getElementById('preview-b').textContent = v.toUpperCase();
    }

    document.getElementById(`step-${currentStep}`).classList.remove('active');
    document.getElementById(`dot-${currentStep}`).classList.remove('active');
    document.getElementById(`dot-${currentStep}`).classList.add('done');

    currentStep = n;
    document.getElementById(`step-${currentStep}`).classList.add('active');
    document.getElementById(`dot-${currentStep}`).classList.remove('done');
    document.getElementById(`dot-${currentStep}`).classList.add('active');

    // Focus input on step
    setTimeout(() => {
      const inp = document.querySelector(`#step-${n} input`);
      if (inp) inp.focus();
    }, 80);
  }

  function syncNameA() {
    // live feedback (optional)
  }

  function syncNameB() {}

  function launchGame() {
    const na = document.getElementById('name-a').value.trim();
    const nb = document.getElementById('name-b').value.trim();
    if (!na || !nb) return;

    names.A = na.toUpperCase();
    names.B = nb.toUpperCase();

    // Apply names throughout the game UI
    document.getElementById('cname-a').textContent = names.A;
    document.getElementById('cname-b').textContent = names.B;
    document.getElementById('btn-label-a').textContent = names.A;
    document.getElementById('btn-label-b').textContent = names.B;
    document.getElementById('surr-label-a').textContent = names.A;
    document.getElementById('surr-label-b').textContent = names.B;

    document.getElementById('screen-setup').classList.add('hidden');
    document.getElementById('screen-game').classList.add('active');

    broadcast('game_start');
    addLog(`‚ö° Subasta iniciada: ${names.A} vs ${names.B}`, 'log-gold');
    addLog(`${names.A} tiene el primer turno ‚Äî 15 segundos.`, 'log-a');
    updateUI();
    startTimer();
  }

  // ‚îÄ‚îÄ‚îÄ AMOUNT SELECTOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function selectPill(el) {
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('selected'));
    el.classList.add('selected');
    bidAmount = parseInt(el.dataset.val);
    document.getElementById('custom-amount').value = '';
  }

  function applyCustom() {
    const v = parseInt(document.getElementById('custom-amount').value);
    if (!v || v < 1) return;
    bidAmount = v;
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('selected'));
  }

  // ‚îÄ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function startTimer() {
    clearInterval(timerInterval);
    timeLeft = TURN_SECONDS;
    renderTimer();
    broadcast('timer_tick');
    timerInterval = setInterval(() => {
      timeLeft--;
      renderTimer();
      broadcast('timer_tick');
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        handleTimeout();
      }
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
  }

  function renderTimer() {
    const arc   = document.getElementById('timer-arc');
    const num   = document.getElementById('timer-number');
    const ring  = document.getElementById('timer-ring-container');
    const block = document.getElementById('timer-block');
    const turnText = document.getElementById('timer-turn-text');
    const sub   = document.getElementById('timer-sub');

    const fraction = Math.max(timeLeft, 0) / TURN_SECONDS;
    arc.style.strokeDashoffset = CIRC * (1 - fraction);
    num.textContent = Math.max(timeLeft, 0);

    arc.className = 'timer-arc';
    num.className = 'timer-number';
    ring.classList.remove('pulsing');
    block.classList.remove('warn-bg', 'urgent-bg');

    if (timeLeft <= 3) {
      arc.classList.add('urgent');
      num.classList.add('urgent');
      ring.classList.add('pulsing');
      block.classList.add('urgent-bg');
    } else if (timeLeft <= 6) {
      arc.classList.add('warn');
      num.classList.add('warn');
      block.classList.add('warn-bg');
    }

    const cur = state.turn;
    turnText.textContent = names[cur];
    turnText.style.color = cur === 'A' ? 'var(--a)' : 'var(--b)';
    sub.textContent = timeLeft > 6
      ? `tiene ${timeLeft}s para pujar o rendirse`
      : timeLeft > 0
        ? `‚ö† ¬°Solo ${timeLeft} segundo${timeLeft !== 1 ? 's' : ''}!`
        : '¬°Tiempo agotado!';
  }

  function handleTimeout() {
    if (state.finished) return;
    state.finished = true;

    const timedOut = state.turn;
    const winner   = timedOut === 'A' ? 'B' : 'A';

    document.body.classList.add('timeout-flash');
    setTimeout(() => document.body.classList.remove('timeout-flash'), 700);

    addLog(`‚è∞ ¬°Tiempo agotado! ${names[timedOut]} no puj√≥ a tiempo.`, 'log-warn');
    broadcast('timeout', { timedOut, winner });
    setTimeout(() => showResult(winner, timedOut, state.bets[winner], state.bets[timedOut], 'timeout'), 800);
  }

  // ‚îÄ‚îÄ‚îÄ GAME LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function getTime() {
    return new Date().toLocaleTimeString('es', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  }

  function addLog(text, cls = 'log-system') {
    const body = document.getElementById('log-body');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerHTML = `<span class="log-time">${getTime()}</span><span class="log-text ${cls}">${text}</span>`;
    body.appendChild(entry);
    body.scrollTop = body.scrollHeight;
  }

  function placeBid(company) {
    if (state.finished) return;
    if (state.lastBidder && state.turn !== company) {
      addLog(`‚ö† Es el turno de ${names[state.turn]}.`, 'log-system');
      return;
    }

    const increment = bidAmount;
    const newBid = state.currentBid + increment;
    state.currentBid = newBid;
    state.bets[company] = newBid;
    state.lastBidder = company;
    state.turn = company === 'A' ? 'B' : 'A';

    const bidEl = document.getElementById('bid-amount');
    bidEl.textContent = `$${newBid}`;
    bidEl.className = `bid-amount ${company === 'A' ? 'a-color' : 'b-color'}`;
    bidEl.classList.add('bump');
    setTimeout(() => bidEl.classList.remove('bump'), 400);

    const bidLabel = increment > 1 ? `$${newBid} (+$${increment})` : `$${newBid}`;
    addLog(`${names[company]} puja ${bidLabel}`, company === 'A' ? 'log-a' : 'log-b');

    if (newBid > PRIZE_VALUE) {
      document.getElementById('warning-strip').classList.add('show');
      document.getElementById('loss-meter').classList.add('visible');
      const pct = Math.min(((state.bets.A + state.bets.B - PRIZE_VALUE) / 80) * 100, 100);
      document.getElementById('loss-bar').style.width = pct + '%';
    }

    broadcast('bid', { bidder: company, amount: newBid, increment });
    updateUI();
    startTimer();
  }

  function updateUI() {
    document.getElementById('bet-a').textContent = `$${state.bets.A}`;
    document.getElementById('bet-b').textContent = `$${state.bets.B}`;

    document.getElementById('status-a').textContent =
      state.lastBidder === 'A' ? 'LIDERA ‚ñ≤' : (state.bets.A > 0 ? 'SEGUNDA' : 'EN ESPERA');
    document.getElementById('status-b').textContent =
      state.lastBidder === 'B' ? 'LIDERA ‚ñ≤' : (state.bets.B > 0 ? 'SEGUNDA' : 'EN ESPERA');

    document.getElementById('card-a').classList.toggle('active-bidder', state.turn === 'A');
    document.getElementById('card-b').classList.toggle('active-bidder', state.turn === 'B');

    const tag = document.getElementById('bidder-tag');
    if (state.lastBidder) {
      tag.textContent = `${names[state.lastBidder]} lidera`;
      tag.className = `current-bidder-tag visible ${state.lastBidder === 'A' ? 'tag-a' : 'tag-b'}`;
    }

    document.getElementById('turn-indicator').textContent = !state.lastBidder
      ? `${names.A} comienza la puja`
      : `Turno de ${names[state.turn]} ‚Üí pr√≥xima oferta: $${state.currentBid + bidAmount}`;

    document.getElementById('btn-bid-a').disabled = state.lastBidder === 'A';
    document.getElementById('btn-bid-b').disabled = state.lastBidder === 'B';

    // Update pill highlight color to match active team
    updatePillColors();
  }

  function updatePillColors() {
    // We just leave gold for selected; color is neutral info
  }

  function showSurrenderMenu() {
    stopTimer();
    document.getElementById('surrender-menu').classList.add('open');
    document.getElementById('btn-bid-a').disabled = true;
    document.getElementById('btn-bid-b').disabled = true;
  }

  function hideSurrenderMenu() {
    document.getElementById('surrender-menu').classList.remove('open');
    document.getElementById('btn-bid-a').disabled = state.lastBidder === 'A';
    document.getElementById('btn-bid-b').disabled = state.lastBidder === 'B';
    if (!state.finished) startTimer();
  }

  function surrender(company) {
    stopTimer();
    state.finished = true;
    const winner = company === 'A' ? 'B' : 'A';
    addLog(`üè≥ ${names[company]} se rinde.`, company === 'A' ? 'log-a' : 'log-b');
    document.getElementById('surrender-menu').classList.remove('open');
    broadcast('surrender', { loser: company, winner });
    setTimeout(() => showResult(winner, company, state.bets[winner], state.bets[company], 'surrender'), 600);
  }

  function showResult(winner, loser, winnerBet, loserBet, type) {
    state.finished = true;
    stopTimer();

    if (type === 'timeout') {
      document.getElementById('timer-arc').style.strokeDashoffset = CIRC;
      document.getElementById('timer-number').textContent = '0';
      document.getElementById('timer-arc').className = 'timer-arc urgent';
      document.getElementById('timer-number').className = 'timer-number urgent';
    }

    const card = document.getElementById('result-card');
    card.className = `result-card winner-${winner.toLowerCase()}`;

    const wC = `result-${winner.toLowerCase()}`;
    const lC = `result-${loser.toLowerCase()}`;

    document.getElementById('result-emoji').textContent =
      type === 'timeout' ? '‚è∞' : type === 'surrender' ? 'üè≥Ô∏è' : 'üèÜ';
    document.getElementById('result-title').textContent =
      type === 'timeout' ? '¬°TIEMPO AGOTADO!' : type === 'surrender' ? 'SE ACAB√ì LA PELEA' : 'PATENTE ADJUDICADA';
    document.getElementById('result-winner').innerHTML =
      `<span class="${wC}">${names[winner]}</span> <span style="color:var(--gold)">GANA</span>`;

    const netWinner = PRIZE_VALUE - winnerBet;
    const netLoser  = -loserBet;

    document.getElementById('result-stats').innerHTML = `
      <div class="result-stat winner-stat">
        <div class="result-stat-label">üèÜ ${names[winner]} ‚Äî GANADORA</div>
        <div class="result-stat-val ${wC}">$${winnerBet}</div>
        <div style="font-size:0.63rem;color:var(--muted);font-family:'IBM Plex Mono',monospace;margin-top:0.25rem;">pag√≥ ¬∑ recibe patente ($${PRIZE_VALUE})</div>
        <div style="font-size:0.72rem;color:${netWinner>=0?'var(--a)':'var(--b)'};font-family:'IBM Plex Mono',monospace;margin-top:0.2rem;font-weight:bold;">
          ${netWinner>=0?'+':''}$${netWinner} neto
        </div>
      </div>
      <div class="result-stat loser-stat">
        <div class="result-stat-label">üí∏ ${names[loser]} ‚Äî PERDEDORA</div>
        <div class="result-stat-val ${lC}">$${loserBet}</div>
        <div style="font-size:0.63rem;color:var(--muted);font-family:'IBM Plex Mono',monospace;margin-top:0.25rem;">pag√≥ ¬∑ no recibe nada</div>
        <div style="font-size:0.72rem;color:var(--b);font-family:'IBM Plex Mono',monospace;margin-top:0.2rem;font-weight:bold;">
          $${netLoser} neto
        </div>
      </div>
    `;

    let lesson;
    if (type === 'timeout') {
      lesson = `‚è∞ <strong>El reloj derrot√≥ a ${names[loser]}.</strong> La presi√≥n del tiempo es una variable m√°s del juego. En negociaciones reales, los deadlines fuerzan decisiones irracionales o par√°lisis total. ${names[loser]} perdi√≥ $${loserBet} por no actuar.`;
    } else if (winnerBet > PRIZE_VALUE) {
      const totalLoss = winnerBet + loserBet - PRIZE_VALUE;
      lesson = `‚ö†Ô∏è <strong>Trampa activada:</strong> ${names[winner]} pag√≥ $${winnerBet} por algo que vale $${PRIZE_VALUE}. Entre las dos empresas se destruyeron $${totalLoss} en total. La espiral de compromiso irracional en acci√≥n.`;
    } else {
      lesson = `üìä ${names[winner]} gan√≥ la patente por $${winnerBet}. ${names[loser]} pierde $${loserBet} sin recibir nada. El miedo a perder lo invertido empuja a seguir pujando ‚Äî la trampa central de este juego.`;
    }

    document.getElementById('result-lesson').innerHTML = lesson;
    document.getElementById('result-overlay').classList.add('show');
    broadcast('result', { winner, loser, winnerBet, loserBet, type });
    setTimeout(() => showMzModal(winner, loser, winnerBet, loserBet, type), 1800);
  }

  // ‚îÄ‚îÄ‚îÄ MATRIZ DE PROBABILIDADES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  function buildMzBar(who, color, pct) {
    return `
      <div class="mz-prob-row">
        <div class="mz-prob-who" style="color:${color}">${who}</div>
        <div class="mz-bar-bg">
          <div class="mz-bar-fill" style="--w:${pct}%;background:${color};opacity:0.85"></div>
        </div>
        <div class="mz-bar-pct" style="color:${color}">${pct}%</div>
      </div>`;
  }

  function buildMzChip(label, cls) {
    return `<div class="mz-chip ${cls}">${label}</div>`;
  }

  function showMzModal(winner, loser, winnerBet, loserBet, type) {
    const nW  = names[winner];
    const nL  = names[loser];
    const nA  = names.A;
    const nB  = names.B;
    const P   = PRIZE_VALUE;

    const netWinner = P - winnerBet;
    const netLoser  = -loserBet;
    const combined  = winnerBet + loserBet;
    const destroyed = Math.max(combined - P, 0);
    const bothBid   = winnerBet > 0 && loserBet > 0;

    const wProb = bothBid ? Math.round((winnerBet / combined) * 100) : 100;
    const lProb = bothBid ? 100 - wProb : 0;

    let activeCell = 'none';
    if (bothBid)          activeCell = 'war';
    else if (winner==='A') activeCell = 'win1';
    else                   activeCell = 'win2';

    // Names
    document.getElementById('mz-names-label').textContent = `${nA} vs ${nB}`;
    document.getElementById('mz-corner').textContent      = `${nA} ‚Üì / ${nB} ‚Üí`;
    ['mz-ch-b1','mz-ch-b2'].forEach(id => document.getElementById(id).textContent = nB);
    ['mz-rh-a1','mz-rh-a2'].forEach(id => document.getElementById(id).textContent = nA);
    document.getElementById('mz-tag-win1').textContent = `‚úì GANA ${nA}`;
    document.getElementById('mz-tag-win2').textContent = `‚úì GANA ${nB}`;

    // Banner
    const bannerWinColor  = winner==='A' ? '#00e5ff' : '#ff3d71';
    const typeLabel = type==='timeout' ? '‚è∞ TIEMPO AGOTADO' : type==='surrender' ? 'üè≥ RENDICI√ìN' : 'üèÜ SUBASTA';
    document.getElementById('mz-banner').innerHTML = `
      <div class="mz-rb-item"><div class="mz-rb-label">Resultado</div><div class="mz-rb-val" style="color:#ffd700;font-size:1rem;">${typeLabel}</div></div>
      <div class="mz-rb-divider"></div>
      <div class="mz-rb-item"><div class="mz-rb-label">Ganadora üèÜ</div><div class="mz-rb-val" style="color:${bannerWinColor}">${nW}</div></div>
      <div class="mz-rb-divider"></div>
      <div class="mz-rb-item"><div class="mz-rb-label">Puja ganadora</div><div class="mz-rb-val">$${winnerBet}</div></div>
      <div class="mz-rb-divider"></div>
      <div class="mz-rb-item"><div class="mz-rb-label">Neto ${nW}</div><div class="mz-rb-val" style="color:${netWinner>=0?'#00e676':'#ff3d71'}">${netWinner>=0?'+':''}$${netWinner}</div></div>
      <div class="mz-rb-divider"></div>
      <div class="mz-rb-item"><div class="mz-rb-label">Neto ${nL}</div><div class="mz-rb-val" style="color:#ff3d71">$${netLoser}</div></div>
      ${destroyed>0?`<div class="mz-rb-divider"></div><div class="mz-rb-item"><div class="mz-rb-label">Valor destruido</div><div class="mz-rb-val" style="color:#ff3d71">‚àí$${destroyed}</div></div>`:''}
    `;

    // Highlight active cell
    ['war','win1','win2','none'].forEach(k => {
      document.getElementById(`mz-cell-${k}`).classList.remove('this-game');
      document.getElementById(`mz-badge-${k}`).style.display = 'none';
    });
    document.getElementById(`mz-cell-${activeCell}`).classList.add('this-game');
    document.getElementById(`mz-badge-${activeCell}`).style.display = 'inline-block';

    // ‚îÄ‚îÄ CELL WAR: Ambos pujan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const aWinProb = winner==='A' ? wProb : lProb;
    const bWinProb = winner==='B' ? wProb : lProb;
    document.getElementById('mz-prob-war').innerHTML =
      buildMzBar(nA, '#00e5ff', aWinProb) + buildMzBar(nB, '#ff3d71', bWinProb);
    document.getElementById('mz-chips-war').innerHTML =
      buildMzChip(`${nW} pag√≥ $${winnerBet}`, 'chip-warn') +
      buildMzChip(`Neto ${nW}: ${netWinner>=0?'+':''}$${netWinner}`, netWinner>=0?'chip-win':'chip-lose') +
      buildMzChip(`${nL} pag√≥ $${loserBet}`, 'chip-warn') +
      buildMzChip(`Neto ${nL}: $${netLoser}`, 'chip-lose') +
      (destroyed>0 ? buildMzChip(`Destruido: $${destroyed}`,'chip-lose') : '');
    document.getElementById('mz-desc-war').innerHTML =
      `Ambas empresas pujaron. <strong>${nW}</strong> gan√≥ pagando <strong>$${winnerBet}</strong> por una patente de <strong>$${P}</strong>.
       ${destroyed>0
         ? `<strong style="color:#ff3d71">¬°Trampa activada!</strong> Entre las dos destruyeron $${destroyed} de valor neto.`
         : `Resultado eficiente: el ganador no sobrepag√≥.`}
       <strong>${nL}</strong> perdi√≥ $${loserBet} sin recibir nada ‚Äî la penalizaci√≥n clave de este juego.`;

    // ‚îÄ‚îÄ CELL WIN1: Solo E1 puja ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const e1Bet = winner==='A' && !bothBid ? winnerBet : 1;
    const e1Net = P - e1Bet;
    document.getElementById('mz-prob-win1').innerHTML =
      buildMzBar(nA, '#00e5ff', 100) + buildMzBar(nB, '#555570', 0);
    document.getElementById('mz-chips-win1').innerHTML =
      buildMzChip(`${nA} puja: $${e1Bet}`, 'chip-warn') +
      buildMzChip(`Neto ${nA}: +$${e1Net}`, 'chip-win') +
      buildMzChip(`${nB}: $0`, 'chip-zero') +
      buildMzChip('Patente adjudicada', 'chip-win');
    document.getElementById('mz-desc-win1').innerHTML =
      `<strong>${nA}</strong> puja $${e1Bet} y <strong>${nB}</strong> no participa.
       <strong>${nA}</strong> obtiene la patente con ganancia neta de <strong style="color:#00e676">+$${e1Net}</strong>.
       <strong>${nB}</strong> no pierde dinero pero renuncia a un valor de $${P}.`;

    // ‚îÄ‚îÄ CELL WIN2: Solo E2 puja ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const e2Bet = winner==='B' && !bothBid ? winnerBet : 1;
    const e2Net = P - e2Bet;
    document.getElementById('mz-prob-win2').innerHTML =
      buildMzBar(nA, '#555570', 0) + buildMzBar(nB, '#ff3d71', 100);
    document.getElementById('mz-chips-win2').innerHTML =
      buildMzChip(`${nA}: $0`, 'chip-zero') +
      buildMzChip(`${nB} puja: $${e2Bet}`, 'chip-warn') +
      buildMzChip(`Neto ${nB}: +$${e2Net}`, 'chip-win') +
      buildMzChip('Patente adjudicada', 'chip-win');
    document.getElementById('mz-desc-win2').innerHTML =
      `<strong>${nB}</strong> puja $${e2Bet} y <strong>${nA}</strong> no participa.
       <strong>${nB}</strong> obtiene la patente con ganancia neta de <strong style="color:#ff3d71">+$${e2Net}</strong>.
       <strong>${nA}</strong> no pierde dinero pero renuncia a un valor de $${P}.`;

    // ‚îÄ‚îÄ CELL NONE: Nadie puja ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.getElementById('mz-prob-none').innerHTML =
      buildMzBar(nA, '#555570', 0) + buildMzBar(nB, '#555570', 0);
    document.getElementById('mz-chips-none').innerHTML =
      buildMzChip(`${nA}: $0`, 'chip-zero') +
      buildMzChip(`${nB}: $0`, 'chip-zero') +
      buildMzChip('Patente sin adjudicar', 'chip-lose') +
      buildMzChip(`‚àí$${P} valor no capturado`, 'chip-lose');
    document.getElementById('mz-desc-none').innerHTML =
      `Ninguna empresa puja. La patente <strong>no se adjudica</strong>.
       Ambas conservan su capital pero el mercado pierde <strong style="color:#ff3d71">$${P} de valor potencial</strong>.
       Fallo de mercado: un activo valioso queda sin asignar por temor mutuo.`;

    // Show modal
    const modal = document.getElementById('matriz-modal');
    modal.style.display = 'flex';
    setTimeout(() => modal.scrollTop = 0, 50);
  }

  function closeMzModal() {
    document.getElementById('matriz-modal').style.display = 'none';
  }

  function resetGame() {
    stopTimer();
    state = { currentBid: 0, lastBidder: null, bets: { A: 0, B: 0 }, turn: 'A', finished: false };
    timeLeft = TURN_SECONDS;
    bidAmount = 1;
    currentStep = 0;
    broadcast('reset');

    // Reset UI
    document.getElementById('bid-amount').textContent = '$0';
    document.getElementById('bid-amount').className = 'bid-amount neutral';
    document.getElementById('bidder-tag').className = 'current-bidder-tag';
    document.getElementById('warning-strip').classList.remove('show');
    document.getElementById('loss-meter').classList.remove('visible');
    document.getElementById('loss-bar').style.width = '0%';
    document.getElementById('log-body').innerHTML = '';
    document.getElementById('result-overlay').classList.remove('show');
    document.getElementById('matriz-modal').style.display = 'none';
    document.getElementById('screen-game').classList.remove('active');
    document.getElementById('surrender-menu').classList.remove('open');

    // Reset timer visuals
    const arc = document.getElementById('timer-arc');
    arc.className = 'timer-arc';
    arc.style.strokeDashoffset = '0';
    document.getElementById('timer-number').className = 'timer-number';
    document.getElementById('timer-number').textContent = TURN_SECONDS;
    document.getElementById('timer-ring-container').classList.remove('pulsing');
    document.getElementById('timer-block').classList.remove('warn-bg','urgent-bg');
    document.getElementById('timer-turn-text').textContent = '‚Äî ‚Äî ‚Äî';
    document.getElementById('timer-sub').textContent = 'El juego est√° por comenzar';

    // Reset pills
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('selected'));
    document.querySelector('.pill[data-val="1"]').classList.add('selected');
    document.getElementById('custom-amount').value = '';

    // Reset setup steps
    document.querySelectorAll('.setup-card').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.step-dot').forEach(d => { d.classList.remove('active','done'); });
    document.getElementById('step-0').classList.add('active');
    document.getElementById('dot-0').classList.add('active');
    document.getElementById('name-a').value = '';
    document.getElementById('name-b').value = '';

    document.getElementById('screen-setup').classList.remove('hidden');
  }
</script>
</body>
</html>
